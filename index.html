<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Hub</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<style>
body { font-family: 'Inter', sans-serif; background: #f3f4f6; }
.card { background: white; border-radius: 0.75rem; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.badge { border-radius: 9999px; padding: 0.25rem 0.5rem; font-size: 0.75rem; }
.badge-cj { background-color: #dbeafe; color: #1e40af; }
.badge-bri { background-color: #fce7f3; color: #9d174d; }
.badge-both { background-color: #ede9fe; color: #5b21b6; }
</style>
</head>
<body class="p-4">

<header class="mb-4 flex justify-between items-center">
  <h1 class="text-2xl font-bold">üè† Family Hub</h1>
  <button id="installBtn" class="bg-blue-600 text-white px-3 py-1 rounded">Install</button>
</header>

<!-- Filters -->
<div class="mb-4 flex gap-2">
  <button data-filter="all" class="filter-btn bg-gray-200 px-3 py-1 rounded">All</button>
  <button data-filter="CJ" class="filter-btn bg-blue-100 px-3 py-1 rounded">CJ</button>
  <button data-filter="Bri" class="filter-btn bg-pink-100 px-3 py-1 rounded">Bri</button>
  <button data-filter="Both" class="filter-btn bg-purple-100 px-3 py-1 rounded">Both</button>
</div>

<!-- Tasks -->
<section class="card mb-4">
  <h2 class="text-lg font-semibold mb-2">Tasks</h2>
  <form id="taskForm" class="flex gap-2 mb-3">
    <input type="text" id="taskTitle" placeholder="Task title" class="flex-1 border rounded px-2 py-1" required>
    <select id="taskUser" class="border rounded px-2 py-1">
      <option value="CJ">CJ</option>
      <option value="Bri">Bri</option>
      <option value="Both">Both</option>
    </select>
    <button class="bg-blue-600 text-white px-3 py-1 rounded">Add</button>
  </form>
  <ul id="taskList" class="space-y-2"></ul>
</section>

<!-- Backlog -->
<section class="card mb-4">
  <div class="flex justify-between items-center mb-2">
    <h2 class="text-lg font-semibold">Backlog</h2>
    <button id="toggleBacklog" class="text-sm text-blue-600">Show</button>
  </div>
  <form id="backlogForm" class="flex gap-2 mb-3 hidden">
    <input type="text" id="backlogTitle" placeholder="Backlog item" class="flex-1 border rounded px-2 py-1">
    <select id="backlogUser" class="border rounded px-2 py-1">
      <option value="CJ">CJ</option>
      <option value="Bri">Bri</option>
      <option value="Both">Both</option>
    </select>
    <button class="bg-blue-600 text-white px-3 py-1 rounded">Add</button>
  </form>
  <ul id="backlogList" class="space-y-2 hidden"></ul>
</section>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyBXVs-RwqcbLM672Tx5QWu48v9nPCvLXDY",
  authDomain: "family-hub-4b2f3.firebaseapp.com",
  databaseURL: "https://family-hub-4b2f3-default-rtdb.firebaseio.com",
  projectId: "family-hub-4b2f3",
  storageBucket: "family-hub-4b2f3.firebasestorage.app",
  messagingSenderId: "479792531016",
  appId: "1:479792531016:web:c7afa4e48a6de7616bfa7d",
  measurementId: "G-HY6SM81G7E"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let filterUser = "all";

// --- UI Refs ---
const taskList = document.getElementById('taskList');
const backlogList = document.getElementById('backlogList');

// --- Render Items ---
function renderList(listEl, data) {
  listEl.innerHTML = "";
  for (let id in data) {
    const item = data[id];
    if (filterUser !== 'all' && item.user !== filterUser) continue;
    const li = document.createElement('li');
    li.className = "flex justify-between items-center border rounded px-2 py-1";
    li.innerHTML = `
      <span>${item.title}</span>
      <span class="badge ${item.user==='CJ'?'badge-cj':item.user==='Bri'?'badge-bri':'badge-both'}">${item.user}</span>
    `;
    listEl.appendChild(li);
  }
}

// --- Listen for Changes ---
db.ref('tasks').on('value', snap => {
  renderList(taskList, snap.val() || {});
});
db.ref('backlog').on('value', snap => {
  renderList(backlogList, snap.val() || {});
});

// --- Add Task ---
document.getElementById('taskForm').addEventListener('submit', e => {
  e.preventDefault();
  const title = document.getElementById('taskTitle').value;
  const user = document.getElementById('taskUser').value;
  const id = db.ref().child('tasks').push().key;
  db.ref('tasks/' + id).set({ title, user });
  e.target.reset();
});

// --- Add Backlog ---
document.getElementById('backlogForm').addEventListener('submit', e => {
  e.preventDefault();
  const title = document.getElementById('backlogTitle').value;
  const user = document.getElementById('backlogUser').value;
  const id = db.ref().child('backlog').push().key;
  db.ref('backlog/' + id).set({ title, user });
  e.target.reset();
});

// --- Filter ---
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    filterUser = btn.dataset.filter;
    db.ref('tasks').once('value', snap => renderList(taskList, snap.val() || {}));
    db.ref('backlog').once('value', snap => renderList(backlogList, snap.val() || {}));
  });
});

// --- Backlog Toggle ---
document.getElementById('toggleBacklog').addEventListener('click', () => {
  backlogList.classList.toggle('hidden');
  document.getElementById('backlogForm').classList.toggle('hidden');
});
</script>

<script>
// --- PWA Install ---
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block';
});
installBtn.addEventListener('click', () => {
  deferredPrompt.prompt();
});
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
